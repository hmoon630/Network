# 챕터 9

## 보안

IT에서 정보 보안은 다양한 위협으로부터 정보를 보호하는 것을 뜻한다.

보안의 필수 요소로 3대 보안 정의를 꼽을 수 있다.
- 기밀성(Confidentiality): 정보를 보지 못하게 하는 모든 작업
- 무결성(Integrity): 정확하고 완전한 정보 유지에 필요한 모든 작업
- 가용성(Availability): 정보가 필요할 때 접근을 허락하는 작업

### 네트워크 보안

네트워크 보안의 목표는 외부로부터 내부를 보호하는 것이다. 이때 보호 받아야 하는 것을 Trust 네트워크, 외부 네트워크를 Untrust 네트워크로 구분한다.

네트워크 보안은 트래픽의 방향과 용도에 따라 두 가지로 나뉜다.
- 인터넷 시큐어 게이트웨이: Trust -> Untrust 통제
- 데이터 센터 시큐어 게이트웨이: Untrust -> Trust 통제

인터넷으로 나갈 때는 수 많은 서비스에 있으므로 그에 대한 정보와 요청 패킷을 인식하고 필터링 하는 기능이 필요하다. 반면 데이터 센터 게이트웨이는 외부의 직접적인 공격을 막아야 하므로 고성능, 공격 관련 정보가 중요하다.

전자는 방화벽, SWG(Secure Web Gateway), 웹 필터(Web Filter), 애플리케이션 컨트롤, 샌드박스와 같은 장비가 포함된다.

후자는 IPS(Intrusion Prevention System), DCSG(DataCenter Secure Gateway), WAF, Anti-DDOS 등의 장비가 포함된다.

## 보안 솔루션 종류

데이터 센터에서 보안 장비를 디자인 할 때 **DDoS - 방화벽 - IPS - WAF** 형태로 장비를 배치한다.

### IDS, IPS

Intrusion Detection System과 Intrusion Prevention System은 방화벽에서 감지하지 못하는 애플리케이션 공격을 방어한다. 최근에는 IPS로 통칭한다.

IPS는 사전에 공격 데이터베이스(Signature)를 제조사나 Threat Intelligence 업체로부터 받는다.

## 방화벽

방화벽은 네트워크 중간에서 장비를 통과하는 트래픽을 사전에 정의된 정책에 맞추어 허용/차단 하는 장비이다.

일반적으로 방화벽은 L3, L4에서 동작하는 Stateful Packet Inspection(상태 기반 엔진)으로 동작한다.

초기의 방화벽은 세션이 존재하지 않고 정책만으로 필터링 했는데 이를 **패킷 필터 방화벽**이라 하였다.

### 방화벽 동작

SPI 엔진을 가진 방화벽은 세션 인지 기능이 있어 5-튜플 조건(Source IP, Port, Destionation IP, Port, Protocol No.)뿐 아니라 L3, L4 필드도 확인한다. Seq와 Ack 번호가 갑자기 변경되는 것을 인지해 세션 탈취 공격을 일부 방어할 수 있다. 이를 TCP Anti-Replay 기능이라고 한다.

### ALG

FTP는 컨트롤과 데이터 프로토콜이 분리되어 있다.

패시브 방식으로 바꾸면 문제 없지만, 액티브 모드를 사용하는 경우 방화벽에서 통과시키기 위해 프로토콜을 확인하고 필요에 따라 세션을 인지해 자동으로 포트를 열어준다. 이를 **Application Layer Gateway** 기능이라고 한다.

일반적으로 ALG는 PAT를 통과하지 못하는 프로토콜들을 자동으로 인지해 애플리케이션 정보를 변경해주거나 세션 테이블을 만들어주는 작업을 수행한다.

요즘 애플리케이션은 방화벽, NAT, Session Traversal Utilities for NAT와 같은 홀 펀칭 기술을 고려해 개발되고 있기 때문에 ALG는 잘 사용되지 않는다.

## IPS

IPS는 방화벽에서 필터링 할 수 없는 애플리케이션 계층의 다양한 공격을 탐지, 방어하는 시스템이다.

### 동작 방식

IPS는 기본적으로 공격 데이터베이스(Signature)를 사용한 패턴 매칭 방식으로 공격을 탐지한다.

패틴 매칭 기반 방식은 패턴에 극미한 변화만 생겨도 적절항 대응이 어려웠다. 그래서 특정 기준 이상의 행위를 감지하면 이상하다고 판단하고 방어한다. 이 기법은 프로파일 어노말리와 프로토콜 어노말리로 나뉜다.

- 프로파일 어노말리
    관리자가 정한, 혹은 장비에 정해진 기준과 다른 행위가 일어나면 공격으로 판단한다. 프린트 서버에 FTP 패킷이 전송되거나 평소보다 과도하게 트래픽이 발생한 경우에 초점을 맞춘다.

    이 기능은 동적 프로파일 기능이 강화되며 향후 DDoS 방어 장비로 진화했다.

- 프로토콜 어노말리
    최근 공격은 SPI 방화벽과 NAT에 의해 직접 PC를 공격하기 어려워졌다. 그래서 악성 프로그램을 사용자가 직접 다운 받도록 한 후 해커의 C&C 서버로 연결하도록 한다.

    이 때 사용하는 포트와 프로토콜이 잘 알려진 것과 다를 경우 이를 탐지한다.

### IPS의 한계와 극복

IPS는 빠른 속도로 애플리케이션 레벨까지 확인하기 위해 Flow 엔진을 사용한다. 이는 패킷을 모아 데이터 형태로 변환해 검사하는 것이 아닌 패킷이 흘러가는 상황을 모니터링 하여 탐지하므로 비교적 쉽게 우회가 된다.

IPS는 오탐이 많이 발생하여 초기에 튜닝장업이 많이 필요하다.

최근 IPS를 향상시켜 Next Generation IPS 장비가 출시되었다.

## DDoS 방어 장비

DDoS는 워낙 대규모 공격이므로 탐지 장비와 방어 장비를 구분하여 사용하는 경우가 많았다. DDoS를 탐지하여 공격을 수행하는 IP 리스트를 넘겨주면 방어 장비나 ISP 내부에서 드랍하는 것이 가장 흔한 방어 기법이다.

### DDoS 공격 타입

- 볼류 메트릭 공격
  - 대용량의 트래픽을 사용해 대역폭을 포화시키는 공격
  - 공격에 의해 생성된 트래픽으로 서비스에 대한 액세스를 완전히 차단함
  - NTP 증폭, DNS 증폭, UDP, TCP 플러드
- 프로토콜 공격
  - L3 L4 프로토콜 스택의 취약점을 공격해 대상을 액세스 할 수 있게 만드는 공격
  - 공격 대상의 리소스 처리 용량을 모두 사용하여 서비스 중단 유발
  - Syn 플러드, Ping of Death
- 애플리케이션 공격
  - L7 프로토콜 스택의 약점을 악용한 공격. 가장 정교하고 식별, 완화가 까다로운 공격
  - 프로세스와 트랜잭션을 독점해 자원을 소모시킴.
  - HTTP 플러드, DNS 서비스 공격, Slowloris

## VPN

VPN은 주로 인터넷과 같은 공중망을 사설망처럼 사용하기 위해 도입하므로 강력한 보안을 제공 해야 한다. 그래서 IPSEC, SSL과 같은 암호화 기법이 주로 같이 사용된다.
