# 챕터 5

## 라우터

라우터는 다양한 경로 정보를 수집해 최적의 경로를 라우팅 테이블에 저장한 후 패킷이 들어오면 이에 맞게 패킷을 내보낸다. 스위치와 달리 라우터는 들어온 패킷의 목적지 주소가 라우팅 테이블에 없으면 패킷을 버린다.

### 브로드캐스트 컨트롤

라우터는 바로 연결되어 있는 네트워크 정보를 제외하고 경로 습득 설정을 하지 않으면 패킷을 포워딩 하지 않고 브로드캐스트 또한 하지 않는다. 이 기능을 통해 다른 네트워크로 전파되는 것을 막을 수 있다. 이를 "브로드캐스트 컨트롤/멀티캐스트 컨트롤"이라고 한다.

### 프로토콜 변환

라우터는 패킷이 들어오면 L2까지의 헤더 정보를 벗겨내고 L3 주소를 확인한 후 L2 헤더 정보를 새로 만들어 외부로 내보낸다. 이 기능을 이용해 LAN과 WAN 변환이 가능하다.

## 경로 지정

### 라우팅

라우터는 패킷의 목적지 주소가 라우터가 갖고 있는 라우팅 테이블과 가장 근접한 정보를 찾아 패킷을 포워딩 한다.

넥스트 홉을 지정할 때에는 3가지 방법을 사용한다.
- 다음 라우터의 IP 지정
- 라우터의 나가는 인터페이스 지정
- 둘 다 지정

라우팅을 할 때에는 출발지를 고려하지 않기 때문에 라우팅 테이블에는 도착지 정보만이 포함된다.
- 목적지 주소
- 넥스트 홉 IP 주소, 나가는 로컬 인터페이스

### 스위칭

패킷이 들어와 라우팅 테이블을 참조하고 최적의 경로를 찾아 라우터 외부로 포워딩 하는 작업을 **스위칭**이라고 한다.

도착지 IP가 완벽히 일치하지 않더라도 가장 가깝게 매치되는 경로 정보를 찾는다. Longest Prefix Match 기법을 사용해 경로 정보 중 가장 가까운 정보를 선택한다.

하지만 이 과정이 많은 부하를 일으키기 때문에 한번 스위칭 한 정보는 캐시에 저장하고, 서치 할 때도 캐시를 먼저 참조한다.

경우에 따라 저장하는 정보의 종류가 다를 수 있다.
- 도착지 IP
- \+ 출발지 IP
- \+ 포트
- \+ 넥스트 홉 L2 정보

### 라우팅, 스위칭 우선순위

라우팅 정보를 수집하는 방법은 3가지가 있다. 그에 따른 라우팅 우선순위는 다음과 같다.

1. 다이렉트 커넥티드
2. 스태틱 라우팅
3. 다이나믹 라우팅
